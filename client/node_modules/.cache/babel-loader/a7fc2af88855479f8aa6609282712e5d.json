{"ast":null,"code":"import { initialSteps } from \"../components/ProfileCreation/ProfileFormUtils\";\nimport axios from 'axios';\nconst initialState = {\n  currentStep: 0,\n  gender: 'woman',\n  preferences: ['female', 'male', 'other'],\n  bio: '',\n  tagList: [],\n  initialTags: [],\n  profilePic: [],\n  picCount: 0,\n  profileBlob: '',\n  signupSuccess: false,\n  steps: initialSteps\n};\n\nconst checkFieldValidity = formData => {\n  switch (formData.currentStep) {\n    case 0:\n      formData.steps[0].success = !!formData.gender;\n      return;\n\n    case 1:\n      formData.steps[1].success = formData.preferences.length > 0;\n      return;\n\n    case 2:\n      formData.steps[2].success = formData.bio.length > 0 && formData.bio[0].length <= 140;\n      return;\n\n    case 3:\n      formData.steps[3].success = formData.tagList.length > 0;\n      return;\n\n    case 4:\n      formData.steps[4].success = formData.profilePic.length > 0 && formData.profilePic.length < 6;\n      return;\n\n    case 5:\n      formData.steps[5].success = !formData.steps.map(step => step.success !== true);\n      return;\n\n    default:\n      return;\n  }\n};\n\nconst registrationReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'CHOOSE_GENDER':\n      return { ...state,\n        gender: action.data,\n        steps: state.steps.map((step, index) => index === 0 ? { ...step,\n          success: true\n        } : step)\n      };\n\n    case 'UPDATE_FIELD':\n      const {\n        field,\n        value\n      } = action.data;\n      return { ...state,\n        [field]: value\n      };\n\n    case 'CHANGE_PAGE':\n      return { ...state,\n        currentStep: action.data\n      };\n\n    case 'ADD_IMAGE':\n      return { ...state,\n        profilePic: action.data\n      };\n\n    case 'FORM_SUCCESS':\n      return { ...state,\n        signupSuccess: action.data\n      };\n\n    case 'GET_TAGS':\n      return { ...state,\n        initialTags: action.data\n      };\n\n    case 'VALIDATE_STEPS':\n      return state;\n\n    default:\n      return state;\n  }\n};\n\nexport const changePage = newPage => {\n  return dispatch => {\n    dispatch({\n      type: 'CHANGE_PAGE',\n      data: newPage\n    });\n  };\n};\nexport const updateField = (field, value) => {\n  return dispatch => {\n    dispatch({\n      type: 'UPDATE_FIELD',\n      data: {\n        field: field,\n        value: value\n      }\n    });\n  };\n};\nexport const checkFormValidity = formData => {\n  return dispatch => {\n    const validatedFormData = checkFieldValidity(formData);\n    dispatch({\n      type: 'VALIDATE_STEPS',\n      data: validatedFormData\n    });\n  };\n};\n\nconst readFile = async file => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onerror = () => reject(reader.error.message);\n\n    reader.onload = () => {\n      resolve(reader.result);\n    };\n\n    if (file) reader.readAsDataURL(file);\n  });\n};\n\nexport const addProfilePicture = fileArray => {\n  return async dispatch => {\n    let base64Array = [];\n\n    for (const file of fileArray) {\n      const base64Picture = await readFile(file);\n      base64Array.push(base64Picture);\n    }\n\n    dispatch({\n      type: 'ADD_IMAGE',\n      data: base64Array\n    });\n  };\n};\nexport const submitProfileForm = (formData, userData) => {\n  return async dispatch => {\n    // a complicated way to check if all are ok...\n    let success, response;\n\n    if (!formData.steps.map((step, index) => index < 5 ? step.success : true).every(value => value === true)) {\n      alert('Error: Insert all the stuff');\n      return;\n    }\n\n    try {\n      response = await axios.post(`http://localhost:3001/api/users/profile/${userData.id}`, formData);\n      if (response.status === 201) success = true;\n    } catch (error) {\n      console.log(error);\n    }\n\n    const user = JSON.parse(localStorage.getItem(\"user\"));\n\n    if (success) {\n      user.status = 2;\n      localStorage.setItem(\"user\", JSON.stringify(user));\n      dispatch({\n        type: 'FORM_SUCCESS',\n        data: success\n      });\n    }\n  };\n};\nexport const getInitialTags = () => {\n  return async dispatch => {\n    try {\n      //axios.defaults.headers.common['Authorization'] = `Bearer ${userData.token}`;\n      const response = await axios.get('http://localhost:3001/api/tags');\n      dispatch({\n        type: 'GET_TAGS',\n        data: response.data\n      });\n    } catch (err) {\n      dispatch({\n        type: 'GET_TAGS',\n        data: null\n      });\n    }\n  };\n};\nexport default registrationReducer;","map":{"version":3,"sources":["/opt/lampstack-8.1.7-0/apache2/htdocs/matcha-2.0/client/src/reducers/registrationReducer.js"],"names":["initialSteps","axios","initialState","currentStep","gender","preferences","bio","tagList","initialTags","profilePic","picCount","profileBlob","signupSuccess","steps","checkFieldValidity","formData","success","length","map","step","registrationReducer","state","action","type","data","index","field","value","changePage","newPage","dispatch","updateField","checkFormValidity","validatedFormData","readFile","file","Promise","resolve","reject","reader","FileReader","onerror","error","message","onload","result","readAsDataURL","addProfilePicture","fileArray","base64Array","base64Picture","push","submitProfileForm","userData","response","every","alert","post","id","status","console","log","user","JSON","parse","localStorage","getItem","setItem","stringify","getInitialTags","get","err"],"mappings":"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","sourcesContent":["import {initialSteps} from \"../components/ProfileCreation/ProfileFormUtils\";\nimport axios from 'axios';\n\nconst initialState = {\n    currentStep: 0,\n    gender: 'woman',\n    preferences: ['female', 'male', 'other'],\n    bio: '',\n    tagList: [],\n    initialTags: [],\n    profilePic: [],\n    picCount: 0,\n    profileBlob: '',\n    signupSuccess: false,\n    steps: initialSteps\n}\n\nconst checkFieldValidity = (formData) => {\n    switch (formData.currentStep) {\n        case 0:\n            formData.steps[0].success = !!formData.gender;\n            return;\n        case 1:\n            formData.steps[1].success = formData.preferences.length > 0;\n            return;\n        case 2:\n            formData.steps[2].success = formData.bio.length > 0 && formData.bio[0].length <= 140;\n            return;\n        case 3:\n            formData.steps[3].success = formData.tagList.length > 0;\n            return;\n        case 4:\n            formData.steps[4].success = formData.profilePic.length > 0 && formData.profilePic.length < 6\n            return;\n        case 5:\n            formData.steps[5].success = !(formData.steps.map(step => step.success !== true));\n            return;\n        default:\n            return;\n    }\n}\n\nconst registrationReducer = (state = initialState, action) => {\n    switch (action.type) {\n        case 'CHOOSE_GENDER':\n            return {\n                ...state,\n                gender: action.data,\n                steps: state.steps.map((step, index) => index === 0 ? {...step, success: true} : step)\n            }\n        case 'UPDATE_FIELD':\n            const { field, value } = action.data\n            return {...state, [field]: value}\n        case 'CHANGE_PAGE':\n            return {...state, currentStep: action.data}\n        case 'ADD_IMAGE':\n            return {...state, profilePic:  action.data}\n        case 'FORM_SUCCESS':\n            return {...state, signupSuccess: action.data}\n        case 'GET_TAGS':\n            return {...state, initialTags: action.data}\n        case 'VALIDATE_STEPS':\n                return state;\n        default:\n            return state;\n    }\n}\n\nexport const changePage = (newPage) => {\n    return dispatch => {\n        dispatch({type: 'CHANGE_PAGE', data: newPage})\n    }\n}\n\nexport const updateField = (field, value) => {\n    return dispatch => {\n        dispatch({type: 'UPDATE_FIELD', data: {field: field, value: value}})\n\n    }\n}\n\nexport const checkFormValidity = (formData) => {\n    return dispatch => {\n        const validatedFormData = checkFieldValidity(formData)\n        dispatch({type: 'VALIDATE_STEPS', data: validatedFormData})\n    }\n}\nconst readFile = async (file) => {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onerror = () => reject(reader.error.message);\n        reader.onload = () => {\n            resolve(reader.result)\n        };\n        if (file) reader.readAsDataURL(file);\n    });\n}\nexport const addProfilePicture = (fileArray) => {\n    return async dispatch => {\n        let base64Array = [];\n        for (const file of fileArray) {\n            const base64Picture = await readFile(file);\n            base64Array.push(base64Picture);\n        }\n        dispatch({type: 'ADD_IMAGE', data: base64Array})\n    }\n}\n\nexport const submitProfileForm = (formData, userData) => {\n    return async dispatch => {\n        // a complicated way to check if all are ok...\n        let success, response;\n        if (!((formData.steps\n            .map((step, index) => index < 5\n                ? step.success\n                : true))\n            .every(value => value === true))) {\n            alert('Error: Insert all the stuff');\n            return;\n        }\n        try {\n            response = await axios\n                .post(`http://localhost:3001/api/users/profile/${userData.id}`, formData)\n            if (response.status === 201) success = true;\n        } catch (error) {\n            console.log(error)\n        }\n        const user = JSON.parse(localStorage.getItem(\"user\"));\n        if (success) {\n            user.status = 2;\n            localStorage.setItem(\"user\", JSON.stringify(user))\n            dispatch({type: 'FORM_SUCCESS', data: success});\n        }\n    }\n}\n\nexport const getInitialTags = () => {\n    return async dispatch => {\n        try {\n            //axios.defaults.headers.common['Authorization'] = `Bearer ${userData.token}`;\n            const response = await axios.get('http://localhost:3001/api/tags')\n            dispatch({type: 'GET_TAGS', data: response.data})\n        } catch (err) {\n            dispatch({type: 'GET_TAGS', data: null})\n        }\n    }\n}\n\nexport default registrationReducer"]},"metadata":{},"sourceType":"module"}